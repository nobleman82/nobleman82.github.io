@page "/projects"
@using System.Net.Http.Json
@inject HttpClient Http

<div class="container-fluid content-padding animate__animated animate__fadeIn">
    <div class="row mb-4 ps-lg-5">
        <div class="col-12">
            <h5 class="text-primary fw-bold mb-1">Portfolio</h5>
            <h2 class="display-5 fw-bolder text-dark">Meine Software-Projekte</h2>
            <p class="text-muted fs-6">Eine Übersicht meiner Arbeiten, live von GitHub synchronisiert.</p>
        </div>
    </div>

    @if (repos == null)
    {
        <div class="d-flex justify-content-center align-items-center" style="height: 300px;">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status"></div>
                <p class="text-muted mt-2">Synchronisiere mit GitHub...</p>
            </div>
        </div>
    }
    else
    {
        <div class="row g-4 px-lg-5 pb-5">
            @foreach (var repo in repos)
            {
                <div class="col-md-6 col-xl-4 col-xxl-3">
                    <div class="project-card shadow-sm h-100 d-flex flex-column">
                        <div class="card-image-wrapper">
                            <img src="@($"https://raw.githubusercontent.com/Nobleman82/{repo.Name}/master/preview.png")"
                                 onerror="this.onerror=null; this.src='https://via.placeholder.com/600x300/1a2a6c/ffffff?text=@(repo.Name.Replace(".", "+"))'"
                                 alt="Projekt Vorschau" />
                        </div>

                        <div class="card-body-custom p-4 d-flex flex-column flex-grow-1">
                            <h3 class="repo-name mb-2">@(repo.Name == "nobleman82.github.io" ? "Persönliches Portfolio" : repo.Name)</h3>

                            <p class="repo-desc text-muted mb-4">
                                @(string.IsNullOrEmpty(repo.Description) ? "Ein spannendes Software-Projekt auf GitHub. Schau dir den Code direkt an!" : repo.Description)
                            </p>

                            <div class="mt-auto">
                                <div class="d-flex align-items-center justify-content-between mb-3">
                                    @if (!string.IsNullOrEmpty(repo.Language))
                                    {
                                        <span class="badge-lang">
                                            <i class="@GetIcon(repo.Language)"></i> @repo.Language
                                        </span>
                                    }

                                    <div class="popularity-indicator" title="GitHub Stars">
                                        <i class="bi bi-star-fill text-warning me-1"></i>
                                        <span class="score-value">@repo.Stargazers_Count</span>
                                    </div>
                                </div>

                                <a href="@repo.Html_Url" target="_blank" class="btn btn-primary btn-sm rounded-pill w-100 py-2">
                                    Code auf GitHub <i class="bi bi-github ms-1"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<style>
    /* Card Design */
    .project-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid rgba(0,0,0,0.05);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
        }

    .card-image-wrapper {
        height: 180px;
        overflow: hidden;
        background: #f0f0f0;
    }

        .card-image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    .repo-name {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1a2a6c;
    }

    .repo-desc {
        font-size: 0.9rem;
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    /* Badges & Indicators */
    .badge-lang {
        background: rgba(111, 66, 193, 0.1);
        color: #6f42c1;
        padding: 4px 12px;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }

    .popularity-indicator {
        background: #f8f9fa;
        padding: 4px 10px;
        border-radius: 10px;
        font-size: 0.85rem;
        border: 1px solid rgba(0,0,0,0.03);
    }

    .score-value {
        font-weight: 800;
        color: #333;
    }

    /* Hilfsklasse für den Text-Gradient (falls in app.css definiert) */
    .text-gradient {
        background: linear-gradient(135deg, #1a2a6c, #6f42c1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
</style>

@code {
    public class GitHubRepo
    {
        public string Name { get; set; } = "";
        public string? Description { get; set; }
        public string Html_Url { get; set; } = "";
        public string? Language { get; set; }
        public int Stargazers_Count { get; set; }
    }

    private GitHubRepo[]? repos;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            repos = await Http.GetFromJsonAsync<GitHubRepo[]>("https://api.github.com/users/Nobleman82/repos");

            if (repos != null)
            {
                repos = repos.OrderByDescending(r => r.Stargazers_Count).ToArray();
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Fehler beim Laden: {ex.Message}");
        }
    }

    private string GetIcon(string language) => language?.ToLower() switch
    {
        "c#" => "bi-hash",
        "javascript" => "bi-filetype-js",
        "css" => "bi-palette",
        "html" => "bi-code-slash",
        "python" => "bi-terminal",
        _ => "bi-journal-code"
    };
}